{% set settings = config.plugins.seo.header %}

{% set fallbackImageUrl = url('/user/images/logo.jpg') %} 
{% set imageUrl = page.header.article.image_url ?: fallbackImageUrl %}

{% if settings.robots or page.header.robots is defined %}
<meta name="robots" content="{{ page.header.robots|default(settings.robots)|default('index') }}">
{% endif %}

<meta property="og:title" content="{% if page.header.facebooktitle is defined and not empty %}{{ page.header.facebooktitle }} {% else %}{{ page.title ~ " | " ~ 'site_title'|t|raw }}{% endif %}" />
<meta property="og:url" content="{{ page.url(true) }}" />
<meta property="og:description" content="{% if page.header.facebookdesc is defined and not empty %}{{ page.header.facebookdesc }} {% else %}{{ page.summary|striptags|truncate(300)|default(site.description) }}{% endif %}" />
<meta property="og:image" content="{{ imageUrl }}" />
<meta property="twitter:image" content="{{ imageUrl }}" />

{# --- Aura-Inspired Schema Markup --- #}

{% set homepageUrl = base_url_absolute %}
{% set languageCode = grav.language.getActive %}

{% set isBlogPost = page.template == 'item' %}
{% set isBlogCategory = page.template == 'blog' and page.header.content.items is defined and page.header.content.items %}

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {# Organization Schema #}
    {
      "@type": "Organization",
      "@id": "{{ homepageUrl }}#organization",
      "name": "{{ 'site_title'|t|raw }}",
      "url": "{{ homepageUrl }}/{{ languageCode }}@organization",
      "logo": {
        "@type": "ImageObject",
        "@id": "{{ homepageUrl }}#logo",
        "url": "{{ fallbackImageUrl }}"
      }
    },

    {# Website Schema #}
    {
      "@type": "WebSite",
      "@id": "{{ homepageUrl }}#website",
      "url": "{{ homepageUrl }}",
      "name": "{{ 'site_title'|t|raw }}",
      "publisher": {
        "@id": "{{ homepageUrl }}#organization"
      }
    },

    {# WebPage Schema #}
    {
      "@type": "WebPage",
      "@id": "{{ page.url(true) }}#webpage",
      "url": "{{ page.url(true) }}",
      "inLanguage": "{{ grav.language.getActive }}",
      "name": "{{ page.title }}",
      "isPartOf": {
	"@type": "WebPage",
        "@id": {% if isBlogPost %}
                 "{{ page.parent.url(true) }}#webpage"
               {% else %}
                 "{{ homepageUrl }}/{{ languageCode }}#website"
               {% endif %}
      },
      "datePublished": "{{ page.date|date('c') }}",
      "dateModified": "{{ page.modified|date('c') }}",
      "description": "{{ page.header.metadata.description|default(page.header.meta.description)|default(page.summary|striptags|truncate(160)) }}"
    },

    {# Article Schema #}
{% do grav.language.setActive(grav.language.getActive) %}
    {% if isBlogPost %}
    {
      "@type": "TechArticle",
      "@id": "{{ page.url(true) }}#article",
      "isPartOf": {
        "@id": "{{ page.url(true) }}#webpage"
      },
      "headline": "{{ page.title }}",
      "datePublished": "{{ page.date|date('c') }}",
      "dateModified": "{{ page.modified|date('c') }}",
      "toc": "#toc",
      "mainEntityOfPage": {
        "@id": "{{ page.url(true) }}#webpage"
      },
      "publisher": {
        "@id": "{{ homepageUrl }}#organization"
      },
      "author": {
        "@type": "Person",
        "name": "{{ author }}",
	"url": "https://www.website.com#author"
	"SameAs": [...
	]
    },
      "image": {
	"@type": "ImageObject",
        "@id": "{{ page.url(true) }}#primaryimage",
        "url": {% if page.header.article.image_url %} "{{ page.header.article.image_url }}" {% else %} "{{ fallbackImageUrl }}" {% endif %}
      }
}
    {% endif %}
  ]
}
</script>

{# --- Breadcrumb Schema --- #}

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "@id": "{{ homepageUrl }}#breadcrumb-home",
      "name": "{{ 'site_title'|t }}",
      "item": "{{ homepageUrl }}"
    },
    {% if isBlogCategory or isBlogPost %}
    {
      "@type": "ListItem",
      "position": 2,
      "name": "{{ page.parent.title }}",
      "@id": "{{ page.parent.url(true) }}#breadcrumb-parent",
      "item": "{{ page.parent.url(true) }}"
    },
    {% endif %}
    {% if isBlogPost %}
    {
      "@type": "ListItem",
      "position": 3,
      "@id": "{{ page.url(true) }}#breadcrumb-current",
      "name": "{{ page.title }}",
      "item": "{{ page.url(true) }}"
    }
    {% endif %}
  ]
}
</script>
